## Data Cleaning for Economic Dataset
## Last Updated: Monday, March 24

# Import libraries
library(tidyverse)

# Read in from csv: download from https://data.census.gov/table?q=median+income&g=040XX00US36$8600000 
dfRaw <- read.csv("ACSST5Y2023.S1901-Data.csv")
cols <- read.csv("ACSST5Y2023.S1901-Column-Metadata.csv")$Label
cols <- tolower(str_replace_all(cols, 
                                pattern = c("," = "", "\\$" = "", "\\(" = "", 
                                            "\\)" = "", " " = "_", "!!" = "_", "-" = "_")
                                )
                )
cols <- str_replace_all(cols,
                        pattern = c("margin_of_error" = "moe", "estimate" = "est")
                        )

nyc_zips = c("10001", "10002", "10003", "10004", "10005", "10006", "10007", "10009",
           "10010", "10011", "10012", "10013", "10014", "10016", "10017", "10018",
           "10019", "10021", "10022", "10023", "10024", "10025", "10026",
           "10027", "10028", "10029", "10030", "10031", "10032", "10033", "10034",
           "10035", "10036", "10037", "10038", "10039", "10040", "10044",
           "10104", "10105", "10106", "10107", "10113",
           "10114", "10116", "10117", "10118", "10120", "10121",
           "10122", "10123", "10124", "10125", "10126", "10128", "10280", "10282",
           "10451", "10452", "10453", "10454", "10455", "10456", "10457", "10458",
           "10459", "10460", "10461", "10462", "10463", "10464", "10465", "10466",
           "10467", "10468", "10469", "10470", "10471", "10472", "10473", "10474",
           "10475", "11201", "11203", "11204", "11205", "11206", "11207", "11208", 
           "11209", "11210", "11211", "11212", "11213", "11214", "11215", "11216", "11217",
           "11218", "11219", "11220", "11221", "11222", "11223", "11224", "11225",
           "11226", "11228", "11229", "11230", "11231", "11232", "11233", "11234",
           "11235", "11236", "11237", "11238", "11239", "11240", "11241", "11242",
           "11243", "11244", "11249",
           "11101", "11102", "11103", "11104", "11105", "11106", "11109",
           "11352", "11354", "11355", "11356", "11357", "11358", "11360",
           "11361", "11362", "11363", "11364", "11365", "11366", "11367", "11368",
           "11369", "11370", "11372", "11373", "11374", "11375", "11377",
           "11378", "11379", "11385", "11411", "11412", "11413", "11414", "11415",
           "11416", "11691", "11692", "11693", "11694", "11695", "11697",
           "10301", "10302", "10303", "10304", "10305", "10306", "10307", "10308",
           "10309", "10310", "10312", "10314")

# Data cleaning
df <- dfRaw[-1,] %>%
  select(-X) %>%
  rename_with(~cols) %>% # col rename
  mutate(ZIP = str_replace(geographic_area_name, '.* ', '')) %>%
  filter(ZIP %in% nyc_zips) %>% # filter to NYC
  select(-geography, -geographic_area_name) %>% relocate(ZIP) %>%
  mutate_if(is.character, as.numeric) %>% # coerce to NAs
  mutate(ZIP = as.character(ZIP))

# Export to csv
write.csv(df, "nyc_economic_data.csv")
